(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[379],{83342:function(e,t,r){Promise.resolve().then(r.bind(r,6948))},91933:function(e,t,r){"use strict";var a=r(9268),n=r(35846),s=r.n(n),l=r(86006);let o={regular:"max-w-xs text-white bg-primary hover:opacity-2 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded text-sm px-5 py-2.5 text-center hover:bg-secondary text-[13px] md:text-sm lg:text-15px leading-4 h-11 md:h-[50px] px-5 lg:px-6 py-4 md:py-3.5 lg:py-4"};t.Z=l.memo(function(e){let{label:t,nameIcon:r,type:n="button",location:l="",design:i="regular",width:c="120px",handleClick:d=()=>{}}=e,u="".concat(o[i]," w-[").concat(c,"]");return l?(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(s(),{className:"".concat(u),href:l,children:[(0,a.jsx)("i",{className:"fas ".concat(r)})," ",t]})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("button",{className:"".concat(u),type:n,onClick:d,children:[(0,a.jsx)("i",{className:"fas ".concat(r)})," ",t]})})})},6029:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});var a=r(9268);function n(e){let{label:t,defaultValue:r="",items:n,validations:s={}}=e;return(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("div",{className:"relative w-full mb-3",children:[(0,a.jsx)("label",{className:"block font-normal text-sm leading-none mb-3 cursor-pointer text-gray-500",children:t}),(0,a.jsx)("select",{className:"border-0 px-3 py-3 placeholder-blueGray-300 text-blueGray-600 bg-white rounded text-sm shadow focus:outline-none focus:ring w-full ease-linear transition-all duration-150",defaultValue:r,...s,children:n.map((e,t)=>(0,a.jsx)("option",{value:e.id,children:e.name},t))})]})})}},22202:function(e,t,r){"use strict";r.d(t,{Z:function(){return n},s:function(){return s}});var a=r(9268);function n(e){let{validations:t}=e;return(0,a.jsxs)("div",{className:"relative flex pt-6 md:pt-8 lg:pt-10",children:[(0,a.jsxs)("div",{className:"pr-2.5 rtl:pl-2.5",children:[(0,a.jsx)("h3",{className:"text-brand-dark text-15px sm:text-base font-semibold mb-1 font-medium",children:"Estado"}),(0,a.jsx)("p",{className:"text-brand-muted text-sm leading-7 lg:leading-[1.85em]",children:"Activa o desactiva en caso de uso"})]}),(0,a.jsx)("div",{className:"ml-auto rtl:mr-auto",children:(0,a.jsx)(s,{validations:t})})]})}function s(e){let{validations:t}=e;return(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer ml-auto rtl:mr-auto",children:[(0,a.jsx)("input",{type:"checkbox",className:"sr-only peer",...t}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-secondary"})]})}},6948:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var a=r(9268),n=r(19124),s=r(69799);let l=()=>{let{tryCatch:e}=(0,n.V)(),t=async t=>{let{idRole:r}=t;return e(async()=>{let e=await fetch("/api/permissions/getAll?idRole=".concat(r)),t=await e.json();return t},e=>e)},r=async()=>e(async()=>{let e=await fetch("/api/permissions/getModulesAndActions"),t=await e.json();return t},e=>e),a=async t=>e(async()=>{let e=await fetch("/api/permissions/set",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await e.json();return r},()=>{(0,s.w)({message:"Permisos actualizados"})});return{getPermissionssForIdRole:t,getModulesAndActions:r,editPermissions:a}};var o=r(86006),i=r(19700),c=r(91933),d=r(6029),u=r(77948),x=r(22202);function m(){let{register:e,handleSubmit:t,setValue:r}=(0,i.cI)({mode:"onChange"}),{getPermissionssForIdRole:n,getModulesAndActions:s,editPermissions:m}=l(),{getActivedRoles:f}=(0,u.d)(),[h,p]=(0,o.useState)([]),[g,y]=(0,o.useState)([]);(0,o.useEffect)(()=>{f().then(e=>{if((null==e?void 0:e.length)>0){p(e);let[t]=e;r("idRole",null==t?void 0:t.id),b().then(()=>{j({idRole:t.id})})}})},[]);let b=async()=>{let e=await s(),{modules:t,actions:r}=e,a=t.map(e=>{let t=r.map(e=>({...e}));return{...e,actions:t}});y(a)},j=e=>{let{idRole:t}=e;n({idRole:t}).then(e=>{let{modules:t,actions:a,permissions:n}=e;t.forEach(e=>{a.forEach(t=>{let a=n.find(r=>{let{codeAction:a,codeModule:n}=r;return a===t.code&&n===e.code});r("control-".concat(t.code,"-").concat(e.code),!!a)})})})},w=async e=>{let t=null==e?void 0:e.idRole;delete e.idRole;let r=Object.keys(e),a=Object.values(e),n=r.map((e,t)=>{let r=e.split("-")[1],n=e.split("-")[2];return{codeAction:r,codeModule:n,isChecked:!!a[t]}});n=n.filter(e=>{let{isChecked:t}=e;return t}),await m({permissionsWhithoutRole:n,idRole:t})};return(0,a.jsx)("div",{className:"relative overflow-x-auto sm:rounded-lg",children:(0,a.jsxs)("form",{onSubmit:t(w),children:[(0,a.jsxs)("div",{className:"flex justify-between align-center mb-5",children:[(0,a.jsx)("h2",{className:"text-brand-dark text-base lg:text-lg xl:text-[20px] font-semibold xl:leading-8 mb-5 md:mb-6 lg:mb-7 lg:-mt-1",children:"Permisos"}),(0,a.jsx)(c.Z,{label:"Guardar",type:"submit"})]}),(0,a.jsx)(d.Z,{items:h,validations:{...e("idRole",{onChange:e=>{let t=e.target.value;j({idRole:t})}})}}),(0,a.jsxs)("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:[(0,a.jsx)("thead",{className:"text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-3",children:"M\xf3dulo"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3",children:"Detalle/Acci\xf3n"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-3"})]})}),(0,a.jsx)("tbody",{children:null==g?void 0:g.map(t=>{let{id:r,name:n,code:s,actions:l}=t;return(0,a.jsxs)("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700",children:[(0,a.jsx)("th",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",children:n}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("table",{className:"w-full text-sm text-left text-gray-500 dark:text-gray-400",children:(0,a.jsx)("tbody",{children:null==l?void 0:l.map(t=>{let{id:r,name:l,code:o}=t;return(0,a.jsxs)("tr",{className:"bg-white border-b dark:bg-gray-800 dark:border-gray-700",children:[(0,a.jsxs)("th",{scope:"row",className:"px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white",children:[l," ",n]}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)(x.s,{validations:{...e("control-".concat(o,"-").concat(s))}})})})]},r)})})})})]},r)})})]})]})})}},84894:function(e,t,r){"use strict";r.r(t),r.d(t,{LoadingContext:function(){return s},default:function(){return l}});var a=r(9268),n=r(86006);let s=n.createContext({});function l(e){let{children:t}=e,[r,l]=(0,n.useState)(!1);return(0,a.jsx)(s.Provider,{value:{loading:r,setLoading:l},children:t})}},19124:function(e,t,r){"use strict";r.d(t,{V:function(){return o}});var a=r(69799);let n=e=>{let{message:t="Error de conexion no mapeado",isError:r}=e;return r&&(0,a.G)({message:t}),{isError:r}};var s=r(16554),l=r(56008);let o=()=>{let{showLoading:e,hideLoading:t}=(0,s.r)(),r=(0,l.useRouter)(),a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return"TokenExpiredError"===e||"JsonWebTokenError"===e||"NotBeforeError"===e},o=async function(s){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e();try{let e=await s(),{name:o}=e;t(),a(o)&&r.push("/logout");let{isError:i}=n(e);return i||(e=await l(e)),e}catch(e){t(),n({isError:!0})}},i=async r=>{e();try{let e=await r();return n(e),t(),e}catch(e){t(),n({isError:!0})}},c=async(r,a)=>{e();try{let e=await r();t();let{isError:s}=n(e);s||a(e)}catch(e){t(),n({isError:!0})}};return{tryCatchReturnResponse:i,tryCatchOnlyActions:c,tryCatch:o}}},16554:function(e,t,r){"use strict";r.d(t,{r:function(){return s}});var a=r(86006),n=r(84894);let s=()=>{let{loading:e,setLoading:t}=(0,a.useContext)(n.LoadingContext);return{isLoading:!!e,showLoading:()=>t(!0),hideLoading:()=>t(!1)}}},77948:function(e,t,r){"use strict";r.d(t,{d:function(){return l}});var a=r(19124),n=r(69799),s=r(56008);let l=()=>{let{tryCatch:e}=(0,a.V)(),t=(0,s.useRouter)(),r=async()=>e(async()=>{let e=await fetch("/api/roles/getAll"),t=await e.json();return t},e=>e),l=async()=>e(async()=>{let e=await fetch("/api/roles/getAll?state=1"),t=await e.json();return t},e=>e),o=async t=>{let{id:r}=t;return e(async()=>{let e=await fetch("/api/roles/getOne?id=".concat(r)),t=await e.json();return t},e=>e)},i=async r=>e(async()=>{let e=await fetch("/api/roles/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await e.json();return t},()=>{(0,n.w)({message:"\xa1Rol agregado!"}),t.push("/account/roles")}),c=async(r,a)=>e(async()=>{let e=await fetch("/api/roles/edit?id=".concat(r),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await e.json();return t},()=>{(0,n.w)({message:"\xa1Rol editado!"}),t.push("/account/roles")});return{getAllRoles:r,getActivedRoles:l,getOneRole:o,addNewRole:i,editRole:c}}},69799:function(e,t,r){"use strict";r.d(t,{G:function(){return s},w:function(){return l}});var a=r(40856),n=r.n(a);let s=e=>{let{message:t}=e;n().fire({icon:"error",html:"<h4>".concat(t,"</h4>"),timer:3e3,showConfirmButton:!1,width:400,padding:"2em 3em",background:"#fff url(/images/trees.png)",backdrop:"\n    rgba(123, 0, 0, 0.4)\n    left top\n    no-repeat\n  "})},l=e=>{let{message:t}=e;n().fire({icon:"success",html:"<h4>".concat(t,"</h4>"),timer:3e3,showConfirmButton:!1,width:400,padding:"2em 3em",backdrop:"\n    rgba(129, 233, 121, 0.4)\n    left top\n    no-repeat\n  "})}}},function(e){e.O(0,[377,846,700,667,488,744],function(){return e(e.s=83342)}),_N_E=e.O()}]);